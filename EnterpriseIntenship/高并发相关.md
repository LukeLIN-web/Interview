# 高并发相关

面试官之问：知道你的接口“QPS”是多少吗？

**QPS（Query Per Second）：每秒请求数，就是说服务器在一秒的时间内处理了多少个请求。**

那我们怎么估出每秒钟能处理多少请求呢？

用日志来估计！细分下来，有两种方式。

*方式一:自己在接口里记录*

这种方式指的是在你的接口里，日志记录了能体现该接口特性的，并具有唯一性的字符串！

```text
 logger.info("渣渣烟");
```

只在index这个接口里出现过，没在其他其他接口里出现过！因此，只要统计出"渣渣烟"这个字符串在日志里的出现次数，就能知道该接口的请求次数！

*方式二:利用tomcat的access log*

我们现在估计出了单机的QPS。接下来，估算集群的QPS。

这就要根据负载均衡的策略来估计！

比如，你部署了32台机器，负载均衡的策略恰巧为轮询，那集群的QPS就是单机的QPS乘32就好了。



#### etcd

etcd 超越了zookeeper

读写性能按照官网给出的数据， 在 2CPU，1.8G 内存，SSD 磁盘这样的配置下，单节点的写性能可以达到 16K QPS, 而先写后读也能达到12K QPS。这个性能还是相当可观。

1. etcd 默认只保存 1000 个历史事件，所以不适合有大量更新操作的场景，这样会导致数据的丢失。
2. etcd 典型的应用场景是配置管理和服务发现，这些场景都是读多写少的。
3. 相比于 zookeeper，etcd 使用起来要简单很多。不过要实现真正的服务发现功能，etcd 还需要和其他工具（比如 registrator、confd 等）一起使用来实现服务的自动注册和更新。